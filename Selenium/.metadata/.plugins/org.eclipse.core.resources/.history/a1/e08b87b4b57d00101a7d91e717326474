package PageObject;

import java.time.Duration;
import java.util.ArrayList;
import java.util.List;
import java.util.NoSuchElementException;
import java.util.Random;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.Keys;
import org.openqa.selenium.StaleElementReferenceException;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;

public class Delivery_Module {
	
	public WebDriver driver;
	
	public Delivery_Module(WebDriver driver) {
		this.driver = driver;
	}
	
	By clickgrid = By.xpath("//div[@class='menu-cont' ] //img[@alt='img']");
	By clickdelivery = By.xpath("//ul//li//span[text()='Delivery']");
	By plackschedule = By.xpath("//ul//li//span[text()='Schedule']");
	By createdeliveryschedule = By.xpath("//*[text()=\"Create Delivery Schedule +\"]");
	
	public void clickgrid() {
		driver.findElement(clickgrid).click();
	}

	public void clickdeliveryoption() {
		driver.findElement(clickdelivery).click();
	}

	public void clickschedule() {
		driver.findElement(plackschedule).click();
	}
	
public void validatehomepage() {
	String expectedTitle = "Schedule Overview";
	WebElement elementTitle = driver.findElement(By.xpath("//*[text()=\"Schedule Overview\"]"));
	String actualTitle = elementTitle.getText();
	 
	 System.out.println("Actual title is: " + actualTitle);
	    Assert.assertEquals(actualTitle, expectedTitle, "Page title does not match!");

	    System.out.println("Home page title validation passed: " + expectedTitle);
}

	public void clickcreatedeliveryschedule() {
	driver.findElement(createdeliveryschedule).click();
}

public void searchfieldvalidation() throws InterruptedException {
	
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(5));
    
    WebElement searchInput = wait.until(
        ExpectedConditions.visibilityOfElementLocated(By.id("pr_parent_id_filterBarcell"))
    );

    String searchTerm = "160767";  // use actual search value
    searchInput.clear();
    searchInput.sendKeys(searchTerm);
    searchInput.sendKeys(Keys.ENTER);  // Trigger the search
    

    Thread.sleep(1000);
     	searchInput.clear();  // Clear the search box
    	searchInput.sendKeys(Keys.ENTER);
    	System.out.println("order Id search filtration is working: pass ");
    	 
    	    
    	WebDriverWait wait2 = new WebDriverWait(driver, Duration.ofSeconds(5));
        
        WebElement searchInput2 = wait2.until(
            ExpectedConditions.visibilityOfElementLocated(By.id("to_org_name_filterBarcell"))
        );
    	String searchTerm2 = "1971 Cafe";  // use actual search value
        searchInput2.clear();
        searchInput2.sendKeys(searchTerm2);
        searchInput2.sendKeys(Keys.ENTER);  // Trigger the search
        
        Thread.sleep(1000);
         	searchInput2.clear();  // Clear the search box
        	searchInput2.sendKeys(Keys.ENTER);
        	System.out.println("Enterprise search filtration is working: pass ");
}

public void assignRandomDrivers() throws InterruptedException {
	
    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
    Actions actions = new Actions(driver);
    Random random = new Random();

    // Step 1: Get all the rows in the table (excluding the header row)
    List<WebElement> rows = driver.findElements(By.xpath("/html/body/div[1]/div/div[2]/div[2]/div/div[2]/div/div[8]/div/table/tbody/tr/td[8]"));

    for (int i = 1; i <= rows.size(); i++) {
        // Step 2: Double-click on the row
        WebElement row = wait.until(ExpectedConditions.elementToBeClickable(
            By.xpath("//*[@id=\"grid_1049538271_0_content_table\"]/tbody")));
        actions.doubleClick(row).perform();

        // Step 3: Wait for the driver dropdown arrow to appear and click it
        WebElement arrow = wait.until(ExpectedConditions.elementToBeClickable(
            By.xpath("//*[@id=\"grid_1049538271_0_content_table\"]/tbody")));
        arrow.click();

        // Step 4: Wait for driver list to appear and select one randomly
        List<WebElement> driverOptions = wait.until(ExpectedConditions.visibilityOfAllElementsLocatedBy(
            By.xpath("//*[contains(@id, 'grid_1049538271_0_content')]")));

        int randomIndex = random.nextInt(driverOptions.size());
        driverOptions.get(randomIndex).click();

        // Optional: Wait briefly before moving to next row
        Thread.sleep(1000);
    }

    System.out.println("âœ… Random drivers assigned to all rows.");
}

/* public void changedrivers() throws InterruptedException {
	 
/*	 WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
	 

     // Locate the row (change selector as needed)
     WebElement row = driver.findElement(By.xpath("/html/body/div[1]/div/div[2]/div[2]/div/div[2]/div/div[8]/div/table/tbody/tr[\"+i+\"]/td[8]"));//*[@id=\"grid_1049538271_0_content_table\"]/tbody/tr[1]

     // Double-click the row
     Actions actions = new Actions(driver);
     actions.doubleClick(row).perform();

     // Wait for dropdown to appear
     driver.findElement(By.xpath("/html/body/div[1]/div/div[2]/div[2]/div/div[2]/div/div[8]/div/table/tbody/tr[\"+i+\"]/td[8]")).click();
     WebElement dropdown = wait.until(
    ExpectedConditions.visibilityOfElementLocated(By.id("driver-dropdown_hidden"))
     );

     // Select a driver
     Select driverSelect = new Select(dropdown);
     driverSelect.selectByValue("Hanumantha");
 }*/
		
public void draganddrop() throws InterruptedException {
	
    WebElement source = driver.findElement(By.xpath("//div[text()='Driver Name']"));
    WebElement target = driver.findElement(By.xpath("//div[@class='e-groupdroparea e-lib e-droppable e-draggable']"));

    Actions actions = new Actions(driver);
    actions.dragAndDrop(source, target).perform();

    Thread.sleep(2000);  

    List<WebElement> driverCheckboxes = driver.findElements(By.xpath("/html/body/div[1]/div/div[2]/div[2]/div/div[2]/div/div[8]/div/table/tbody/tr/td[2]/div/input"));
    for (int i = 0; i < driverCheckboxes.size(); i++) {
        List<WebElement> updatedList = driver.findElements(By.xpath("/html/body/div[1]/div/div[2]/div[2]/div/div[2]/div/div[8]/div/table/tbody/tr/td[2]/div/input"));
        WebElement checkbox = updatedList.get(i);
        if (!checkbox.isSelected()) {
            checkbox.click();
            Thread.sleep(300);
            
   driver.findElement(By.xpath("//*[@id=\"root\"]/div/div[2]/div[2]/div/div[1]/div[2]/div[2]/button"));
   
   Random rand = new Random();

// Find all rows that contain both vehicle and departure time dropdowns
List<WebElement> driverRows = driver.findElements(By.xpath("//table[@id='driverTable']/tbody/tr"));

for (WebElement row : driverRows) {
    try {
        // --- Vehicle Dropdown ---
        WebElement vehicleDropdown = row.findElement(By.xpath(".//select[contains(@id, 'vehicle')]"));
        Select vehicleSelect = new Select(vehicleDropdown);
        int vehicleCount = vehicleSelect.getOptions().size();
        if (vehicleCount > 1) {
            vehicleSelect.selectByIndex(rand.nextInt(vehicleCount));
        }

        // --- Departure Time Dropdown ---
        WebElement timeDropdown = row.findElement(By.xpath(".//select[contains(@id, 'departure')]"));
        Select timeSelect = new Select(timeDropdown);
        int timeCount = timeSelect.getOptions().size();
        if (timeCount > 1) {
            timeSelect.selectByIndex(rand.nextInt(timeCount));
        }

    } catch (NoSuchElementException e) {
        // Skip rows that don't have dropdowns
        System.out.println("Dropdowns not found in one of the rows. Skipping...");
        
        Thread.sleep(2000);
        driver.findElement(By.xpath("//*[@id=\"root\"]/div/div[2]/div[2]/div/div[1]/div[2]/div[2]/button")).click();

            }
}
   
   }
}
    driver.findElement(By.xpath("//div[text()='Next ']")).click();
    }

public void selectRandomVehicleAndTime() throws InterruptedException {
    Random random = new Random();

    List<WebElement> rows = driver.findElements(By.xpath("//div[contains(@class, 'review-select-inputs mb-3')]"));

 // Loop through each row
    for (WebElement row : rows) {
        
        // Get the name text from review-header
    	String name = row.findElement(By.xpath("./preceding-sibling::div[@class='review-header']")).getText();

        System.out.println("Processing row for: " + name);

        try {
            // --- Vehicle ---
        	System.out.println("Row text: " + row.getText());

        	List<WebElement> vehicleDropdowns = row.findElements(By.xpath(".//select[contains(@class,'vehicle')]"));
            if (!vehicleDropdowns.isEmpty()) {
                WebElement vehicleDropdown = vehicleDropdowns.get(0);
                Select vehicleSelect = new Select(vehicleDropdown);
                int vehicleIndex = getRandomOptionIndex(vehicleSelect.getOptions(), random);
                vehicleSelect.selectByIndex(vehicleIndex);
            }

            // --- Time ---
            List<WebElement> timeDropdowns = row.findElements(By.xpath(".//select[@name='pickupBy']"));
            if (!timeDropdowns.isEmpty()) {
                WebElement timeDropdown = timeDropdowns.get(0);
                Select timeSelect = new Select(timeDropdown);
                int timeIndex = getRandomOptionIndex(timeSelect.getOptions(), random);
                timeSelect.selectByIndex(timeIndex);
            }

            // --- Driver ---
            List<WebElement> driverDropdowns = row.findElements(By.xpath(".//select[@name='userName']"));
            if (!driverDropdowns.isEmpty()) {
                WebElement driverDropdown = driverDropdowns.get(0);
                Select driverSelect = new Select(driverDropdown);
                int driverIndex = getRandomOptionIndex(driverSelect.getOptions(), random);
                driverSelect.selectByIndex(driverIndex);
            }

			/*
			 * System.out.println("Row " + (i + 1) + " selected: " + "Vehicle = " +
			 * vehicleSelect.getOptions().get(vehicleIndex).getText() + ", Time = " +
			 * timeSelect.getOptions().get(timeIndex).getText() + ", Driver = " +
			 * driverSelect.getOptions().get(driverIndex).getText());
			 */

        } catch (NoSuchElementException | StaleElementReferenceException e) {
            System.out.println("Dropdown issue in row " + ( + 1) + ": " + e.getMessage());
        }
        Thread.sleep(1000); // optional delay
    }
}

private int getRandomOptionIndex(List<WebElement> options, Random random) {
    if (options.size() <= 1) return 0;
    return random.nextInt(options.size() - 1) + 1; // skip index 0 (e.g., "--Select--")
}


}





